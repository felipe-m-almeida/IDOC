<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLFMAS - Classifica√ß√£o e Caracter√≠sticas</title>
    <link rel="stylesheet" href="estilos.css">
    <script>const IDOC_TREE = [{"segment": "E1OCLFM", "max": 1, "children": [{"segment": "E1KSSKM", "max": 9999, "children": []}, {"segment": "E1AUSPM", "max": 9999, "children": []}, {"segment": "E1DATEM", "max": 1, "children": []}]}, {"segment": "E1UPSLINK", "max": 1, "children": []}]; const SEGMENT_DEFINITIONS = {"E1OCLFM": {"desc": "Mestre classifica\u00e7\u00e3o objetos", "fields": [{"name": "MSGFN", "desc": "Fun\u00e7\u00e3o", "type": "CHAR", "len": "3"}, {"name": "OBTAB", "desc": "Nome da tabela de banco de dados do objeto", "type": "CHAR", "len": "10"}, {"name": "OBJEK", "desc": "Chave do objeto a ser classificado", "type": "CHAR", "len": "50"}, {"name": "KLART", "desc": "Tipo de classe", "type": "CHAR", "len": "3"}, {"name": "MAFID", "desc": "C\u00f3digo objeto/classe", "type": "CHAR", "len": "1"}, {"name": "OBJECT_TABLE", "desc": "Nome da tabela de banco de dados do objeto", "type": "CHAR", "len": "30"}], "max": 1}, "E1KSSKM": {"desc": "Classifica\u00e7\u00e3o distribui\u00e7\u00e3o: atribui\u00e7\u00e3o \u00e0 classe de objeto", "fields": [{"name": "MSGFN", "desc": "Fun\u00e7\u00e3o", "type": "CHAR", "len": "3"}, {"name": "CLASS", "desc": "N\u00ba classe", "type": "CHAR", "len": "18"}, {"name": "AENNR", "desc": "N\u00ba modifica\u00e7\u00e3o", "type": "CHAR", "len": "12"}, {"name": "DATUV", "desc": "Data in\u00edcio validade", "type": "DATS", "len": "8"}, {"name": "STATU", "desc": "Status da classifica\u00e7\u00e3o", "type": "CHAR", "len": "1"}, {"name": "STDCL", "desc": "C\u00f3digo: classe standard", "type": "CHAR", "len": "1"}], "max": 9999}, "E1AUSPM": {"desc": "Distribui\u00e7\u00e3o classifica\u00e7\u00e3o: avalia\u00e7\u00e3o caracter\u00edsticas objeto", "fields": [{"name": "MSGFN", "desc": "Fun\u00e7\u00e3o", "type": "CHAR", "len": "3"}, {"name": "ATNAM", "desc": "Nome da caracter\u00edstica", "type": "CHAR", "len": "30"}, {"name": "AENNR", "desc": "N\u00ba modifica\u00e7\u00e3o", "type": "CHAR", "len": "12"}, {"name": "DATUV", "desc": "Data in\u00edcio validade", "type": "DATS", "len": "8"}, {"name": "ATWRT", "desc": "Valor da caracter\u00edstica", "type": "CHAR", "len": "30"}, {"name": "ATFLV", "desc": "Valor interno v\u00edrgula flutuante desde", "type": "CHAR", "len": "22"}, {"name": "ATAWE", "desc": "Unidade medida", "type": "UNIT", "len": "3"}, {"name": "ATFLB", "desc": "Valor interno v\u00edrgula flutuante at\u00e9", "type": "CHAR", "len": "22"}, {"name": "ATAW1", "desc": "Unidade medida", "type": "UNIT", "len": "3"}, {"name": "ATCOD", "desc": "Code para depend\u00eancia de valores", "type": "CHAR", "len": "1"}, {"name": "ATTLV", "desc": "Toler\u00e2ncia de", "type": "CHAR", "len": "22"}, {"name": "ATTLB", "desc": "Toler\u00e2ncia at\u00e9", "type": "CHAR", "len": "22"}, {"name": "ATPRZ", "desc": "C\u00f3digo de indica\u00e7\u00f5es de toler\u00e2ncias em %", "type": "CHAR", "len": "1"}, {"name": "ATINC", "desc": "Incremento dentro de um intervalo", "type": "CHAR", "len": "22"}, {"name": "ATAUT", "desc": "Classifica\u00e7\u00e3o: autor", "type": "CHAR", "len": "1"}, {"name": "ATIMB", "desc": "N\u00ba caracter\u00edstica da ctg.dados definida pelo usu\u00e1rio", "type": "NUMC", "len": "10"}, {"name": "ATZIS", "desc": "Contador de inst\u00e2ncias", "type": "NUMC", "len": "3"}, {"name": "UDEF_CHAR", "desc": "Nome da caracter\u00edstica", "type": "CHAR", "len": "30"}], "max": 9999}, "E1DATEM": {"desc": "Data-chave mestra e n\u00ba de modifica\u00e7\u00e3o", "fields": [{"name": "MSGFN", "desc": "Fun\u00e7\u00e3o", "type": "CHAR", "len": "3"}, {"name": "KEY_DATE", "desc": "Data do sistema", "type": "DATS", "len": "8"}, {"name": "AENNR", "desc": "N\u00ba modifica\u00e7\u00e3o", "type": "CHAR", "len": "12"}, {"name": "EFFECTIVITY", "desc": "Avaliar par\u00e2metros de validade / substituir n\u00bas modifica\u00e7\u00e3o", "type": "CHAR", "len": "1"}], "max": 1}, "E1UPSLINK": {"desc": "Refer\u00eancia de objeto a UPS superior", "fields": [{"name": "UPSNAM", "desc": "Pacote de distribui\u00e7\u00e3o ALE: nome", "type": "CHAR", "len": "20"}, {"name": "ORGNAM", "desc": "Pacote de distribui\u00e7\u00e3o ALE: pacote original (nome)", "type": "CHAR", "len": "20"}, {"name": "MESTYP", "desc": "Tipo de mensagem", "type": "CHAR", "len": "30"}, {"name": "OBJID", "desc": "Pacote de distribui\u00e7\u00e3o ALE: chave de objeto", "type": "CHAR", "len": "120"}, {"name": "OBJVAL", "desc": "Pacote de distribui\u00e7\u00e3o ALE: validade do objeto", "type": "CHAR", "len": "20"}], "max": 1}};</script>
</head>
<body>
    <header>
        <div class="brand">CLFMAS - Classifica√ß√£o e Caracter√≠sticas</div>
        <div class="search-box"><input type="text" id="searchInput" placeholder="Buscar..."></div>
        <div style="display:flex; gap:10px;">
             <button class="btn-csv" style="background:#15803d; color:white; border:none;" onclick="exportFullCSV()">CSV Completo</button>
             <button class="btn-payload" style="background:#2563eb; color:white; border:none;" onclick="openFullPayloadModal()">Payload Completo</button>
             <a href="index.html" style="text-decoration:none; color:#64748b; font-weight:600; font-size:0.9rem; align-self:center;">Voltar</a>
        </div>
    </header>
    <div class="workspace">
        <aside>
            <div class="history-container">
                <div class="history-header"><span class="history-title">Vistos Recentemente</span><button class="btn-clear-history" onclick="clearHistory()">Limpar</button></div>
                <div id="history-list" class="history-list"></div>
            </div>
            <div class="tree-container"><div class="tree-label">Navega√ß√£o</div><a href="#E1OCLFM" class="node-item" style="padding-left: 10px" onclick="activateNode(this)"><strong>E1OCLFM</strong></a><a href="#E1KSSKM" class="node-item" style="padding-left: 20px" onclick="activateNode(this)"><strong>E1KSSKM</strong></a><a href="#E1AUSPM" class="node-item" style="padding-left: 20px" onclick="activateNode(this)"><strong>E1AUSPM</strong></a><a href="#E1DATEM" class="node-item" style="padding-left: 20px" onclick="activateNode(this)"><strong>E1DATEM</strong></a><a href="#E1UPSLINK" class="node-item" style="padding-left: 10px" onclick="activateNode(this)"><strong>E1UPSLINK</strong></a></div></aside><main id="mainContent">
    <div id="E1OCLFM" class="segment-card">
        <div class="card-header">
            <div class="card-title"><h2>E1OCLFM <span class="desc">Mestre classifica√ß√£o objetos</span></h2></div>
            <div class="badges">
                <button class="btn-csv" onclick="exportToCSV('E1OCLFM')">CSV</button>
                <button class="btn-payload" onclick="openPayloadModal('E1OCLFM')">Payload</button>
                <span class="badge badge-req">Dados</span>
                <span class="badge badge-meta">M√°x: 1</span>
                <span class="badge badge-meta">6 campos</span>
            </div>
        </div>
        <div class="table-wrapper"><table><thead><tr><th style="width: 25%">Campo</th><th style="width: 55%">Descri√ß√£o</th><th style="width: 20%">Tipo/Tam</th></tr></thead><tbody><tr><td><span class="tech-name" onclick="copy(this)">MSGFN</span></td><td>Fun√ß√£o</td><td><span class="dt-type">CHAR(3)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">OBTAB</span></td><td>Nome da tabela de banco de dados do objeto</td><td><span class="dt-type">CHAR(10)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">OBJEK</span></td><td>Chave do objeto a ser classificado</td><td><span class="dt-type">CHAR(50)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">KLART</span></td><td>Tipo de classe</td><td><span class="dt-type">CHAR(3)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">MAFID</span></td><td>C√≥digo objeto/classe</td><td><span class="dt-type">CHAR(1)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">OBJECT_TABLE</span></td><td>Nome da tabela de banco de dados do objeto</td><td><span class="dt-type">CHAR(30)</span></td></tr></tbody></table></div>
    </div>
    <div id="E1KSSKM" class="segment-card">
        <div class="card-header">
            <div class="card-title"><h2>E1KSSKM <span class="desc">Classifica√ß√£o distribui√ß√£o: atribui√ß√£o √† classe de objeto</span></h2></div>
            <div class="badges">
                <button class="btn-csv" onclick="exportToCSV('E1KSSKM')">CSV</button>
                <button class="btn-payload" onclick="openPayloadModal('E1KSSKM')">Payload</button>
                <span class="badge badge-req">Dados</span>
                <span class="badge badge-meta">M√°x: 9999</span>
                <span class="badge badge-meta">6 campos</span>
            </div>
        </div>
        <div class="table-wrapper"><table><thead><tr><th style="width: 25%">Campo</th><th style="width: 55%">Descri√ß√£o</th><th style="width: 20%">Tipo/Tam</th></tr></thead><tbody><tr><td><span class="tech-name" onclick="copy(this)">MSGFN</span></td><td>Fun√ß√£o</td><td><span class="dt-type">CHAR(3)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">CLASS</span></td><td>N¬∫ classe</td><td><span class="dt-type">CHAR(18)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">AENNR</span></td><td>N¬∫ modifica√ß√£o</td><td><span class="dt-type">CHAR(12)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">DATUV</span></td><td>Data in√≠cio validade</td><td><span class="dt-type">DATS(8)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">STATU</span></td><td>Status da classifica√ß√£o</td><td><span class="dt-type">CHAR(1)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">STDCL</span></td><td>C√≥digo: classe standard</td><td><span class="dt-type">CHAR(1)</span></td></tr></tbody></table></div>
    </div>
    <div id="E1AUSPM" class="segment-card">
        <div class="card-header">
            <div class="card-title"><h2>E1AUSPM <span class="desc">Distribui√ß√£o classifica√ß√£o: avalia√ß√£o caracter√≠sticas objeto</span></h2></div>
            <div class="badges">
                <button class="btn-csv" onclick="exportToCSV('E1AUSPM')">CSV</button>
                <button class="btn-payload" onclick="openPayloadModal('E1AUSPM')">Payload</button>
                <span class="badge badge-req">Dados</span>
                <span class="badge badge-meta">M√°x: 9999</span>
                <span class="badge badge-meta">18 campos</span>
            </div>
        </div>
        <div class="table-wrapper"><table><thead><tr><th style="width: 25%">Campo</th><th style="width: 55%">Descri√ß√£o</th><th style="width: 20%">Tipo/Tam</th></tr></thead><tbody><tr><td><span class="tech-name" onclick="copy(this)">MSGFN</span></td><td>Fun√ß√£o</td><td><span class="dt-type">CHAR(3)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATNAM</span></td><td>Nome da caracter√≠stica</td><td><span class="dt-type">CHAR(30)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">AENNR</span></td><td>N¬∫ modifica√ß√£o</td><td><span class="dt-type">CHAR(12)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">DATUV</span></td><td>Data in√≠cio validade</td><td><span class="dt-type">DATS(8)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATWRT</span></td><td>Valor da caracter√≠stica</td><td><span class="dt-type">CHAR(30)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATFLV</span></td><td>Valor interno v√≠rgula flutuante desde</td><td><span class="dt-type">CHAR(22)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATAWE</span></td><td>Unidade medida</td><td><span class="dt-type">UNIT(3)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATFLB</span></td><td>Valor interno v√≠rgula flutuante at√©</td><td><span class="dt-type">CHAR(22)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATAW1</span></td><td>Unidade medida</td><td><span class="dt-type">UNIT(3)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATCOD</span></td><td>Code para depend√™ncia de valores</td><td><span class="dt-type">CHAR(1)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATTLV</span></td><td>Toler√¢ncia de</td><td><span class="dt-type">CHAR(22)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATTLB</span></td><td>Toler√¢ncia at√©</td><td><span class="dt-type">CHAR(22)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATPRZ</span></td><td>C√≥digo de indica√ß√µes de toler√¢ncias em %</td><td><span class="dt-type">CHAR(1)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATINC</span></td><td>Incremento dentro de um intervalo</td><td><span class="dt-type">CHAR(22)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATAUT</span></td><td>Classifica√ß√£o: autor</td><td><span class="dt-type">CHAR(1)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATIMB</span></td><td>N¬∫ caracter√≠stica da ctg.dados definida pelo usu√°rio</td><td><span class="dt-type">NUMC(10)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ATZIS</span></td><td>Contador de inst√¢ncias</td><td><span class="dt-type">NUMC(3)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">UDEF_CHAR</span></td><td>Nome da caracter√≠stica</td><td><span class="dt-type">CHAR(30)</span></td></tr></tbody></table></div>
    </div>
    <div id="E1DATEM" class="segment-card">
        <div class="card-header">
            <div class="card-title"><h2>E1DATEM <span class="desc">Data-chave mestra e n¬∫ de modifica√ß√£o</span></h2></div>
            <div class="badges">
                <button class="btn-csv" onclick="exportToCSV('E1DATEM')">CSV</button>
                <button class="btn-payload" onclick="openPayloadModal('E1DATEM')">Payload</button>
                <span class="badge badge-req">Dados</span>
                <span class="badge badge-meta">M√°x: 1</span>
                <span class="badge badge-meta">4 campos</span>
            </div>
        </div>
        <div class="table-wrapper"><table><thead><tr><th style="width: 25%">Campo</th><th style="width: 55%">Descri√ß√£o</th><th style="width: 20%">Tipo/Tam</th></tr></thead><tbody><tr><td><span class="tech-name" onclick="copy(this)">MSGFN</span></td><td>Fun√ß√£o</td><td><span class="dt-type">CHAR(3)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">KEY_DATE</span></td><td>Data do sistema</td><td><span class="dt-type">DATS(8)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">AENNR</span></td><td>N¬∫ modifica√ß√£o</td><td><span class="dt-type">CHAR(12)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">EFFECTIVITY</span></td><td>Avaliar par√¢metros de validade / substituir n¬∫s modifica√ß√£o</td><td><span class="dt-type">CHAR(1)</span></td></tr></tbody></table></div>
    </div>
    <div id="E1UPSLINK" class="segment-card">
        <div class="card-header">
            <div class="card-title"><h2>E1UPSLINK <span class="desc">Refer√™ncia de objeto a UPS superior</span></h2></div>
            <div class="badges">
                <button class="btn-csv" onclick="exportToCSV('E1UPSLINK')">CSV</button>
                <button class="btn-payload" onclick="openPayloadModal('E1UPSLINK')">Payload</button>
                <span class="badge badge-req">Dados</span>
                <span class="badge badge-meta">M√°x: 1</span>
                <span class="badge badge-meta">5 campos</span>
            </div>
        </div>
        <div class="table-wrapper"><table><thead><tr><th style="width: 25%">Campo</th><th style="width: 55%">Descri√ß√£o</th><th style="width: 20%">Tipo/Tam</th></tr></thead><tbody><tr><td><span class="tech-name" onclick="copy(this)">UPSNAM</span></td><td>Pacote de distribui√ß√£o ALE: nome</td><td><span class="dt-type">CHAR(20)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">ORGNAM</span></td><td>Pacote de distribui√ß√£o ALE: pacote original (nome)</td><td><span class="dt-type">CHAR(20)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">MESTYP</span></td><td>Tipo de mensagem</td><td><span class="dt-type">CHAR(30)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">OBJID</span></td><td>Pacote de distribui√ß√£o ALE: chave de objeto</td><td><span class="dt-type">CHAR(120)</span></td></tr><tr><td><span class="tech-name" onclick="copy(this)">OBJVAL</span></td><td>Pacote de distribui√ß√£o ALE: validade do objeto</td><td><span class="dt-type">CHAR(20)</span></td></tr></tbody></table></div>
    </div></main></div>
    <div id="payloadModal" class="modal-overlay"><div class="modal-container">
            <div class="modal-header"><div class="modal-title">Payload: <span id="modalSegName"></span></div><button class="modal-close" onclick="closePayloadModal()">&times;</button></div>
            <div class="payload-tabs"><div class="payload-tab active" onclick="switchTab('json')">JSON</div><div class="payload-tab" onclick="switchTab('xml')">XML</div></div>
            <div class="modal-body"><pre id="jsonContent" class="payload-content active"></pre><pre id="xmlContent" class="payload-content"></pre></div>
            <div class="modal-footer"><button class="btn-payload" onclick="copyCurrentPayload()">Copiar C√≥digo</button></div>
    </div></div>
    <div id="toast">Copiado!</div>
    <script>
        function copy(el) { navigator.clipboard.writeText(el.innerText).then(() => showToast()); }
        function showToast() { let t = document.getElementById('toast'); t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }
        function activateNode(el) { document.querySelectorAll('.node-item').forEach(i => i.classList.remove('active')); el.classList.add('active'); }
        document.getElementById('searchInput').addEventListener('keyup', function(e) {
            let term = e.target.value.toUpperCase();
            document.querySelectorAll('.segment-card').forEach(card => {
                let show = false;
                if(card.querySelector('.card-header').innerText.toUpperCase().includes(term)) show = true;
                card.querySelectorAll('tbody tr').forEach(row => {
                    if(row.innerText.toUpperCase().includes(term)) { row.classList.remove('hidden'); show = true; } else { row.classList.add('hidden'); }
                });
                card.style.display = show ? 'block' : 'none';
            });
        });

        function exportFullCSV() {
            let csv = "Segmento;Campo;Descri√ß√£o;Tipo;Tamanho\n";
            for (const [segName, data] of Object.entries(SEGMENT_DEFINITIONS)) {
                data.fields.forEach(f => {
                    csv += `${segName};${f.name};${f.desc};${f.type};${f.len}\n`;
                });
            }
            downloadCSV(csv, "IDoc_Completo.csv");
        }

        function exportToCSV(segName) {
            const data = SEGMENT_DEFINITIONS[segName]; if(!data) return;
            let csv = "Campo;Descri√ß√£o;Tipo;Tamanho\n";
            data.fields.forEach(f => { csv += `${f.name};${f.desc};${f.type};${f.len}\n`; });
            downloadCSV(csv, `${segName}.csv`);
        }

        function downloadCSV(content, fileName) {
            const blob = new Blob(["\uFEFF" + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function generateFakeValue(type, name) {
            if (!type) return "texto";
            if (type.includes('NUMC') || type.includes('INT') || type.includes('DEC')) return 123;
            if (type.includes('DATS')) return "20251231";
            if (type.includes('TIMS')) return "235959";
            if (name.includes('CURRENCY') || name.includes('WAERS')) return "BRL";
            if (name.includes('LANG')) return "PT";
            return "texto";
        }
        function getSegmentData(segName) {
            const def = SEGMENT_DEFINITIONS[segName]; if (!def) return {};
            const obj = {};
            def.fields.forEach(f => { obj[f.name] = generateFakeValue(f.type, f.name); });
            return obj;
        }
        function buildFullJson(nodes) {
            const result = {};
            const nodeList = Array.isArray(nodes) ? nodes : [nodes];
            nodeList.forEach(node => {
                let content = getSegmentData(node.segment);
                if (node.children && node.children.length > 0) Object.assign(content, buildFullJson(node.children));
                if (node.max > 1) result[node.segment] = [content]; else result[node.segment] = content;
            });
            return result;
        }
        function jsonToXml(obj, depth = 0) {
            let xml = ''; const indent = '  '.repeat(depth);
            for (const key in obj) {
                const value = obj[key];
                if (Array.isArray(value)) { value.forEach(item => { xml += `${indent}<${key}>\n` + jsonToXml(item, depth + 1) + `${indent}</${key}>\n`; }); }
                else if (typeof value === 'object' && value !== null) { xml += `${indent}<${key}>\n` + jsonToXml(value, depth + 1) + `${indent}</${key}>\n`; }
                else { xml += `${indent}<${key}>${value}</${key}>\n`; }
            }
            return xml;
        }
        function openPayloadModal(segName) {
            document.getElementById('modalSegName').innerText = segName;
            const data = getSegmentData(segName);
            document.getElementById('jsonContent').innerText = JSON.stringify(data, null, 2);
            document.getElementById('xmlContent').innerText = `<${segName}>\n${jsonToXml(data, 1)}</${segName}>`;
            document.getElementById('payloadModal').classList.add('open');
        }
        function openFullPayloadModal() {
            document.getElementById('modalSegName').innerText = "ESTRUTURA COMPLETA";
            let fullData = {};
            if (typeof IDOC_TREE !== 'undefined' && IDOC_TREE.length > 0) fullData = buildFullJson(IDOC_TREE);
            document.getElementById('jsonContent').innerText = JSON.stringify(fullData, null, 2);
            document.getElementById('xmlContent').innerText = `<IDOC>\n${jsonToXml(fullData, 1)}</IDOC>`;
            document.getElementById('payloadModal').classList.add('open');
        }
        function closePayloadModal() { document.getElementById('payloadModal').classList.remove('open'); }
        function switchTab(type) {
            document.querySelectorAll('.payload-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.payload-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(type + 'Content').classList.add('active');
        }
        function copyCurrentPayload() { navigator.clipboard.writeText(document.querySelector('.payload-content.active').innerText).then(() => showToast()); }
        (function() {
            const MAX_HISTORY = 10;
            const HISTORY_KEY = 'sap_docs_history';
            if (!window.location.pathname.endsWith('index.html')) {
                const standardizedTitle = document.title;
                const currentPage = { title: standardizedTitle, url: window.location.pathname.split('/').pop() };
                let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
                history = history.filter(h => h.url !== currentPage.url);
                history.unshift(currentPage);
                if (history.length > MAX_HISTORY) history.pop();
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
                const btn = document.createElement('a'); btn.id = 'global-back-btn'; btn.href = 'index.html'; btn.innerHTML = 'üè†'; btn.title = 'Voltar ao In√≠cio'; document.body.appendChild(btn);
            }
            const container = document.getElementById('history-list');
            if (container) {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
                if (history.length === 0) container.innerHTML = '<div style="padding:5px 8px; font-size:0.75rem; color:#64748b;">Nenhum item recente.</div>';
                else { container.innerHTML = history.map(h => `<a href="${h.url}" class="history-link">${h.title}</a>`).join(''); }
            }
            window.clearHistory = function() { localStorage.removeItem(HISTORY_KEY); if(document.getElementById('history-list')) document.getElementById('history-list').innerHTML = ''; }
        })();
    </script>
</body>
</html>